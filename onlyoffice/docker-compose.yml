version: "3.8"

# ============================================================
# OnlyOffice Document Server
# Location: /root/cmt/onlyoffice/docker-compose.yml
# Start:  docker compose up -d
# Health: curl http://localhost:8080/healthcheck
# ============================================================

services:
  onlyoffice:
    image: onlyoffice/documentserver:latest
    container_name: contractpro-onlyoffice
    restart: always
    ports:
      - "8080:80"
    environment:
      - JWT_ENABLED=true
      - JWT_SECRET=contractpro-oo-jwt-secret-change-this-2024
      - JWT_HEADER=Authorization
      - JWT_IN_BODY=true
      - ONLYOFFICE_HTTPS_HSTS_ENABLED=false

    volumes:
      - onlyoffice_data:/var/www/onlyoffice/Data
      - onlyoffice_logs:/var/log/onlyoffice
      - onlyoffice_cache:/var/lib/onlyoffice
      - onlyoffice_db:/var/lib/postgresql
      # Share backend uploads so OnlyOffice can read/write contract files
      - /root/cmt/backend/uploads:/var/www/onlyoffice/Data/uploads

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s

volumes:
  onlyoffice_data:
  onlyoffice_logs:
  onlyoffice_cache:
  onlyoffice_db:
